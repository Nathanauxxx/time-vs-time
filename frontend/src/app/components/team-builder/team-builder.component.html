<div class="container">
  <header>
    <h1>
      <span style="display: inline-block; width: 50px; height: 50px; background: linear-gradient(180deg, #D4AF37 0%, #C89B3C 100%); border: 3px solid #8B7326; border-radius: 8px; margin-right: 15px; vertical-align: middle; position: relative;">
        <span style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 32px; font-weight: bold; color: #0A1428; font-family: 'Arial Black', sans-serif;">L</span>
      </span>
      ‚öîÔ∏è Construtor de Times
    </h1>
    <p class="subtitle">Monte sua composi√ß√£o perfeita</p>
    
    <div class="header-navigation">
      <a routerLink="/champions" class="btn btn-info btn-sm header-btn">üìã Listar Campe√µes</a>
      <a routerLink="/compositions" class="btn btn-info btn-sm header-btn">üíæ Composi√ß√µes Salvas</a>
      <a routerLink="/add-champion" class="btn btn-info btn-sm header-btn">‚ûï Adicionar Campe√£o</a>
      <button 
        (click)="syncWithRiotApi()" 
        class="btn btn-warning btn-sm header-btn"
        [disabled]="isSyncing"
        title="Sincronizar com API oficial da Riot Games">
        @if (isSyncing) {
          <span class="spinner-border spinner-border-sm me-1"></span>
          üîÑ Sincronizando...
        } @else {
          üéÆ Sincronizar Riot API
        }
      </button>
    </div>
    
    @if (syncMessage) {
      <div class="alert" [class.alert-success]="syncMessage.includes('‚úÖ')" [class.alert-danger]="syncMessage.includes('‚ùå')" [class.alert-info]="syncMessage.includes('üîÑ')">
        {{ syncMessage }}
      </div>
    }
    
    @if (champions.length > 0) {
      <div class="badge">
        üéÆ {{ champions.length }} campe√µes carregados do PostgreSQL
      </div>
    }
  </header>

  <div class="main-content">
    <!-- Time Azul -->
    <div class="team blue-team">
      <h2>üîµ Time Azul</h2>
      <div class="team-composition">
        @for (lane of ['top', 'jungle', 'mid', 'adc', 'support']; track lane) {
          <div class="lane" [attr.data-lane]="lane" [attr.data-team]="'blue'">
            <div class="lane-label">{{ lane.toUpperCase() }}</div>
            <div class="champion-slot" 
                 [attr.data-position]="lane + '-blue'"
                 [class.filled]="getTeamChampion('blue', lane)"
                 (click)="getTeamChampion('blue', lane) ? null : openModal(lane + '-blue')">
              @if (getTeamChampion('blue', lane); as champion) {
                <div class="champion-info">
                  <div class="champion-icon">
                    @if (hasIconUrl(champion)) {
                      <img [src]="champion.iconUrl" [alt]="champion.name">
                    } @else {
                      {{ getChampionIcon(champion) }}
                    }
                  </div>
                  <div class="champion-details">
                    <div class="champion-name">{{ champion.name }}</div>
                    <div class="champion-role">{{ champion.championClass || 'N/A' }}</div>
                  </div>
                </div>
                <button class="btn btn-danger btn-sm remove-btn" (click)="removeChampion(lane + '-blue'); $event.stopPropagation()">√ó</button>
              } @else {
                <span class="btn btn-outline-light placeholder">Selecione</span>
              }
            </div>
          </div>
        }
      </div>
      
      <div class="team-stats" id="blue-stats">
        <div class="stat">
          <span class="stat-label">Dano F√≠sico:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('blue').physical"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Dano M√°gico:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('blue').magic"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Tanques:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('blue').tank"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Controle de Grupo:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('blue').cc"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Time Vermelho -->
    <div class="team red-team">
      <h2>üî¥ Time Vermelho</h2>
      <div class="team-composition">
        @for (lane of ['top', 'jungle', 'mid', 'adc', 'support']; track lane) {
          <div class="lane" [attr.data-lane]="lane" [attr.data-team]="'red'">
            <div class="lane-label">{{ lane.toUpperCase() }}</div>
            <div class="champion-slot" 
                 [attr.data-position]="lane + '-red'"
                 [class.filled]="getTeamChampion('red', lane)"
                 (click)="getTeamChampion('red', lane) ? null : openModal(lane + '-red')">
              @if (getTeamChampion('red', lane); as champion) {
                <div class="champion-info">
                  <div class="champion-icon">
                    @if (hasIconUrl(champion)) {
                      <img [src]="champion.iconUrl" [alt]="champion.name">
                    } @else {
                      {{ getChampionIcon(champion) }}
                    }
                  </div>
                  <div class="champion-details">
                    <div class="champion-name">{{ champion.name }}</div>
                    <div class="champion-role">{{ champion.championClass || 'N/A' }}</div>
                  </div>
                </div>
                <button class="btn btn-danger btn-sm remove-btn" (click)="removeChampion(lane + '-red'); $event.stopPropagation()">√ó</button>
              } @else {
                <span class="btn btn-outline-light placeholder">Selecione</span>
              }
            </div>
          </div>
        }
      </div>
      
      <div class="team-stats" id="red-stats">
        <div class="stat">
          <span class="stat-label">Dano F√≠sico:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('red').physical"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Dano M√°gico:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('red').magic"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Tanques:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('red').tank"></div>
          </div>
        </div>
        <div class="stat">
          <span class="stat-label">Controle de Grupo:</span>
          <div class="stat-bar">
            <div class="stat-fill" [style.width.%]="getTeamStats('red').cc"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√µes de Controle -->
  <div class="controls">
    <button class="btn btn-secondary btn-lg" (click)="clearAll()">üîÑ Limpar Tudo</button>
    <button class="btn btn-warning btn-lg" (click)="compareTeams()" [disabled]="!canCompareTeams()">‚öîÔ∏è Comparar Times</button>
    <button class="btn btn-success btn-lg" (click)="saveComposition()">üíæ Salvar Composi√ß√£o</button>
  </div>

  <!-- Resultado da Compara√ß√£o -->
  @if (comparisonResult) {
    <div class="comparison-result" [class.blue-wins]="comparisonResult.winner === 'blue'" [class.red-wins]="comparisonResult.winner === 'red'">
      <h3>üìä An√°lise Comparativa</h3>
      
      <div class="winner-announcement">
        @if (comparisonResult.winner === 'blue') {
          <h2>üîµ TIME AZUL √â MAIS FORTE!</h2>
        } @else if (comparisonResult.winner === 'red') {
          <h2>üî¥ TIME VERMELHO √â MAIS FORTE!</h2>
        } @else {
          <h2>‚öñÔ∏è TIMES EQUILIBRADOS!</h2>
        }
        <p class="score">Placar: {{ comparisonResult.blueScore }} x {{ comparisonResult.redScore }}</p>
      </div>

      <div class="comparison-details">
        <div class="advantage-section">
          <h4>üí™ Vantagens do Time {{ comparisonResult.winner === 'blue' ? 'Azul' : 'Vermelho' }}</h4>
          <ul>
            @for (adv of comparisonResult.advantages; track adv) {
              <li>{{ adv }}</li>
            }
          </ul>
        </div>

        <div class="weakness-section">
          <h4>‚ö†Ô∏è Pontos Fracos</h4>
          <ul>
            @for (weak of comparisonResult.weaknesses; track weak) {
              <li>{{ weak }}</li>
            }
          </ul>
        </div>

        <div class="recommendation-section">
          <h4>üí° Recomenda√ß√µes</h4>
          <ul>
            @for (rec of comparisonResult.recommendations; track rec) {
              <li>{{ rec }}</li>
            }
          </ul>
        </div>
      </div>

      <button class="btn btn-sm btn-secondary" (click)="comparisonResult = null">Fechar An√°lise</button>
    </div>
  }
</div>

<!-- Modal de Sele√ß√£o de Campe√£o -->
@if (isModalOpen) {
  <div class="modal active" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Selecionar Campe√£o</h2>
        <span class="close" (click)="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <input 
          type="text" 
          placeholder="Buscar campe√£o..."
          [(ngModel)]="searchTerm"
          (input)="filterChampions()"
          class="form-control">
        
        <div class="filter-buttons">
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'all'"
            [class.btn-outline-secondary]="currentFilter !== 'all'"
            (click)="setFilter('all')">Todos</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'tank'"
            [class.btn-outline-secondary]="currentFilter !== 'tank'"
            (click)="setFilter('tank')">Tank</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'fighter'"
            [class.btn-outline-secondary]="currentFilter !== 'fighter'"
            (click)="setFilter('fighter')">Lutador</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'mage'"
            [class.btn-outline-secondary]="currentFilter !== 'mage'"
            (click)="setFilter('mage')">Mago</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'assassin'"
            [class.btn-outline-secondary]="currentFilter !== 'assassin'"
            (click)="setFilter('assassin')">Assassino</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'marksman'"
            [class.btn-outline-secondary]="currentFilter !== 'marksman'"
            (click)="setFilter('marksman')">Atirador</button>
          <button 
            class="btn btn-sm"
            [class.btn-primary]="currentFilter === 'support'"
            [class.btn-outline-secondary]="currentFilter !== 'support'"
            (click)="setFilter('support')">Suporte</button>
        </div>
        
        <div class="champion-grid">
          @if (filteredChampions.length === 0) {
            <div class="empty-message">
              <p>Nenhum campe√£o encontrado para esta busca</p>
            </div>
          }
          @for (champion of filteredChampions; track champion.id) {
            <div class="champion-card" (click)="selectChampion(champion)">
              <div class="champion-card-icon">
                @if (champion.iconUrl) {
                  <img [src]="champion.iconUrl" [alt]="champion.name">
                } @else {
                  <div class="icon-placeholder">{{ champion.name.charAt(0) }}</div>
                }
              </div>
              <div class="champion-card-name">{{ champion.name }}</div>
              <div class="champion-card-class">{{ champion.championClass || 'N/A' }}</div>
            </div>
          }
        </div>
      </div>
    </div>
  </div>
}
